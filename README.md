# go-prepare-scattering-matrices
Подготавливает матрицы рассеяния для использования в модели переноса

Для работы программы необхоимо иметь файл libspheroid.so/libspheroid.dll 
установленный в системе. 
Собрать его можно имея на борту установленны компилятор gnu-fortran. 
Код программы находится в директории fort. 
Там же располагается сткрипт compile.sh, позволяющий собрать библиотеку.


Помятуя по пожеляниях в связи с уже имеющейся программой prepare-scattering-matrices 
на python, программа теперь создает только необходимые файлы. Все промежуточные 
вычисления хранятся в оперативной памяти. В дополнении еще рисует 
графики зависимости степени линейной поляризации от угла рассеяния в png, svg и txt.


Для работы программы необходимо также иметь файлы с базами KERNLS_, которые можно взять 
[отсюда](https://github.com/DrShmirko/prepare-scattering-matrices)

В итоге у вас должна получится следующая структура каталога:

```bash
--+- prepare-mueller-matrices
  +- KRNLS_arnt_sphrds
  +- KRNLS_arnt_sphrs
  +- libspheroid.so/libspheroid.dll
```


Программа поддерживает следующие опции командной строки

```bash
Usage of ./prepare-mueller-matrices:
  -matdir string
        Каталог, для сохранения матриц. (default "./out")
  -picdir string
        Каталог, для сохранения графиков. (default "./pic")
  -sf float
        Пороговое значение сферичности. (default 1)
  -skip int
        Сколько строк пропускать. (default 6)
  -wvl float
        Длина волны для расчета матриц. (default 0.87)
        
```

Указав  sf, мы задаем пороговое значение сферичности, выше которой файлы измерений пропускаются 

## Что получаем на выходе
В результате выполнения программы мы получим файл с префиксом total, 
который содержит нашу матрицу рассеяния и коэффициенты рассеяния, экстинкции и ослабления для всего столба атмосферы, 
приведенные к единичной объемной концентрации. Технически эти коэффициенты - оптические толщи рассеяния, 
ослабления и поглощения, так как у AERONET нет разрешения по высоте. Для задач моделирования нам нужны именно геометрические 
сечения единичной частицы. Поэтому будем полагать что так и есть, но этот аэрозольный слой имеет протяженность 1 км.

## Откуда брать входные данные
Для работы программы необходимо использовать данные AERONET Level 1.5. Единственное, нужно быть внимательными по длинам волн.
Программа настроена на работу с данными на следующих длинах волн 0.4406 0.675, 0.870 и 1.020 мкм, но на некотроых станциях 
[AERONET](https://aeronet.gsfc.nasa.gov/new_web/download_all_v3_inversions.html) 
данные получаются на других длинах волн. Текущая версия программы пропускает их и не обрабатывает.


## Если у вас Windows

Для запуска программы на windows, необходимо ее собрать, предварительно скачав из релизов 
в этом репозитории [архив с динамическими библиотеками](https://github.com/DrShmirko/go-prepare-scattering-matrices/releases/download/v0.2.0/shared_libraries.zip).

Если вы не хотите заморачиваться со сборкой програмы из исходников, просто скачайте бинарники из релизов.

## Что дальше
А дальше я собираюсь встроить ядра для агломератов обломков. Это несколько иные частицы со своими особенностями. Во-первых, для агломератов мы задаем не объемным радиусом, а радиусом описанной окружности. Это правильнее, так как поддается измерению. Во-вторых, диапазон размеров частиц у нас ограничен, по сравнению со сфероидами. Мы имеем матрицы рассеяния, насчитанные для размерных параметров x=0.1..32, что для длины волны 0.440 мкм соответствует диаметру 2.24 мкм, а для длины волны 1.064 мкм - 5.42 мкм.

